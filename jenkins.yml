#
# Configuration for jenkins-job-builder
#
- scm:
    name: dos
    scm:
        - git:
            url: https://github.com/digabi/digabi-os.git
            branches:
                - master
                - feature/*
            browser_url: https://github.com/digabi/digabi-os

- scm:
    name: dos-ypcs
    scm:
        - git:
            url: https://github.com/ypcs/digabi-os.git
            branches:
                - master
                - feature/*
            browser_url: https://github.com/ypcs/digabi-os


- job-template:
    name: '{name}-build'
    project-type: freestyle
    parameters:
        - string:
            name:   DEBIAN_MIRROR
            default: http://http.debian.net/debian
            description: 'Default mirror for downloading packages from.'
        - choice:
            name: DISTRIBUTION
            choices:
                - unstable
                - testing
                - stable
            description: 'Target distribution we are building for.'
        - choice:
            name: DIGABI_BUILD_CPUS
            choices:
                - '2'
                - '4'
                - '8'
                - '1'
            description: 'How many CPU cores to use for this build?'
        - choice:
            name: DIGABI_BUILD_MEM
            choices:
                - '2048'
                - '4096'
                - '8192'
                - '16384'
                - '1024'
                - '512'
                - '256'
            description: 'How much memory to use for this build?'
        - choice:
            name: VAGRANT_DEFAULT_PROVIDER
            choices:
                - virtualbox
                - vmware_workstation
        - password:
            name: ROOT_PASSWORD
            default:
            description: 'Root password to be used with this build.'
        - bool:
            name: DEBUG
            default: false
            description: 'Do a debug build.'
    builders:
        - shell: 'make build-{name}'
    publishers:
        - github-notifier




- project:
    name: dos
    description: 'Build DOS images using live-build.'
    distributions: !!python/tuple [jessie,sid]
    architectures: !!python/tuple &architectures
        - amd64
        - i386
    axis_a:
        type: user-defined
        name: architectures
        values: *architectures
    jobs:
        - '{name}-build'
    publishers:
        - archive:
            artifacts: 'dist/*'
            fingerprint: true
        - logparser:
            parse-rules: "conf/logparser.conf"
            unstable-on-warning: true
            fail-on-error: true

# build-publisher, see http://ci.openstack.org/jenkins-job-builder/publishers.html
# email > recipients
# pipeline
# 

